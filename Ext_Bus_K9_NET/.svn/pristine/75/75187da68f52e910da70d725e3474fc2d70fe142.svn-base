//需先引用IMSMaps.js


var flashArr = new Array() ;
var flashFlag = true ;//是否存在flash
//falsh类
function IMSFlash(x,y,url,width,height){
    var tempXY = map.logicToScreen(x,y) ;
    var flashId = "flash3D"+Math.round(Math.random()*10000) ;
    var width = width?width:71 ;
    var height = height? height: 92
    flashArr.push(x+","+y+","+flashId+","+width+","+height);
    var dL = tempXY[0]-width/2 ;
    var dT = tempXY[1] -height ;
    this.div = CreatDiv(document.body,flashId,dL,dT,"absolute",2) ;
    var str = "<OBJECT id = 'object"+flashId+"' style='LEFT: 0px;  POSITION: absolute; TOP: 0px;  ";
    str += "tcodeBase='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0'";
    str += " height='"+height+"' width='"+height+"' classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' >";
    str += "<PARAM value='"+url+"' name='movie' />" ;
    str += "<PARAM value='high' name='quality' />" ;
    str += "<PARAM value='transparent' name='wmode' /> " ;
    this.div.innerHTML  = str ;
    if(flashFlag){
        map.addEventListener("zoom",reLocation,false);
        flashFlag = false ;
    }
}
//放大缩小时flash重定位
function reLocation(){
    if(flashArr==null)
        return ;
    var curLev = map.getCurLev() ;
    for(var i = 0 ; i<flashArr.length ; i++){
        var tempArr = flashArr[i].split(",") ;
        var tempXY = map.logicToScreen(tempArr[0],tempArr[1]) ;
        var flashObj = document.getElementById(tempArr[2]);
        var obj = document.getElementById("object"+tempArr[2]);
        var zRate = 1+(curLev-1)*8/10 //放大倍数
        var width = zRate*tempArr[3] ;
        var height = zRate*tempArr[4]
        var dL = tempXY[0]- width/2 ;
        var dT = tempXY[1] -height ;
        flashObj.style.left = dL +"px";
        flashObj.style.top = dT +"px";
        obj.height = height +"px";
        obj.width = width +"px";
    }
}

//地图载入状态类
function IMSLoader(loaderImg)
{
    this.imgSrc=loaderImg?loaderImg:"images/loader.gif";
    this.imgSize = GetImgSize(this.imgSrc);
    this.imgLeft = thisObj.pObj.offsetWidth/2-this.imgSize[0]/2;
    this.imgTop = thisObj.pObj.offsetHeight/2-this.imgSize[1]/2;
    this.div = CreatDiv(document.body,"IMSLoader",parseInt(this.imgLeft),parseInt(this.imgTop),"absolute",1,"hidden");
    this.div.innerHTML="<IMG src='"+this.imgSrc+"'>";
    this.isBusy = false;
    thisObj.loader = this;

    this.setBusy = function()
    {
        this.isBusy = true;
        thisObj.isMapMove = true;
        thisObj.isCarMove = true;
        this.div.style.display = "block";
    }

    this.setFree = function()
    {
        this.isBusy = false;
        thisObj.isMapMove = false;
        thisObj.isCarMove = false;
        this.div.style.display = "none";
    }
    
    this.resize = function()
    {
      thisObj.loader.imgLeft = thisObj.pObj.offsetWidth/2-thisObj.loader.imgSize[0]/2;
      thisObj.loader.imgTop = thisObj.pObj.offsetHeight/2-thisObj.loader.imgSize[1]/2;
      thisObj.loader.div.style.left=thisObj.loader.imgLeft+"px";
      thisObj.loader.div.style.top=thisObj.loader.imgTop+"px";
    }
    
    thisObj.addEventListener("resize", thisObj.loader.resize, false);
} 

//地图操作状态类
function IMSOperStatus()
{
    this.div = CreatDiv(document.body,"IMSOperStatus",0,0,"absolute",1,"hidden");
    this.div.innerHTML="<IMG id='ToolFlag' src='images/transparence.gif'>";

    changeStatus=function(Evnt)
    {
        var e=Evnt?Evnt:event; 
        var toolFlg = document.getElementById("ToolFlag"); 
          switch(thisObj.activeTool)
	        {
	            case "ZoomIn"://放大
		            if(toolFlg.nameProp != "zoomIn.gif")
					    toolFlg.src="images/zoomIn.gif";	
		            break;
	            case "ZoomOut"://缩小
		            if(toolFlg.nameProp != "zoomOut.gif")
					    toolFlg.src="images/zoomOut.gif";	
		            break;
	            case "Pan"://移动
		            if(toolFlg.nameProp != "move.gif")
					    toolFlg.src="images/move.gif";
		            break;
		        case "SelectByHitting"://点击查询
			        if(toolFlg.nameProp != "pnt.gif")
					    toolFlg.src="images/pnt.gif";
			        break;
		        case "SelectByRect"://拉框查询
			        if(toolFlg.nameProp != "rect.gif")
					    toolFlg.src="images/rect.gif";
			        break;
		        case "SelectByCircle"://圆查询
			        if(toolFlg.nameProp != "circle.gif")
					    toolFlg.src="images/circle.gif";
			        break;
		        case "SelectByLine"://多边形查询
			        if(toolFlg.nameProp != "area_s.gif")
			            toolFlg.src="images/area_s.gif";
			         break;
			    case "SelectByPolygon"://多边形查询
			        if(toolFlg.nameProp != "polygon.gif")
			            toolFlg.src="images/polygon.gif";
			         break;
                case "MeasureDistance":
                case "MeasureArea":
                    if(toolFlg.nameProp != "measure.gif")
					    toolFlg.src="images/measure.gif";
       	            break;
	             default :
	                if(toolFlg.nameProp != "transparence.gif")
					    toolFlg.src="images/transparence.gif";
					break;
            }
		if(thisObj.isShowOprImg)
		{
		    var tmp=GetClientXY(e,thisObj.pObj);
			toolFlg.parentNode.style.visibility ='visible';
		    toolFlg.parentNode.style.left=(tmp[0] + 15)+"px";
		    toolFlg.parentNode.style.top=(tmp[1] +3)+"px";
	    }
	    else
	    	toolFlg.parentNode.style.visibility ='hidden';
    }
    operImgOut=function()
    {
    	document.getElementById("ToolFlag").parentNode.style.visibility ='hidden';
    }
    thisObj.addEventListener("mousemove", changeStatus, false);
    thisObj.addEventListener("mouseout", operImgOut, false);
} 